name: Label PRs

on:
  pull_request_target:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v44
        with:
          files_yaml: |
            styles:
              - 'src/**/*.css'
              - '**/*.scss'
              - '**/*.sass'
            ci:
              - '.github/**'
              - 'package*.json'
              - 'pnpm-lock.yaml'
              - 'eslint.config.*'
              - 'next.config.*'
              - 'tailwind.config.*'
              - 'tsconfig.json'
              - 'postcss.config.*'
              - 'components.json'
              - 'vercel.json'
            javascript:
              - 'src/**/*.js'
              - 'src/**/*.jsx'
              - 'src/**/*.ts'
              - 'src/**/*.tsx'
            json:
              - 'src/data/**/*.json'
              - '**/*.json'
            assets:
              - 'public/**'
            documentation:
              - '**/*.md'
            test:
              - '**/*.test.*'
              - '**/*.spec.*'
              - 'test/**'
              - 'tests/**'

      - name: Add CI label
        if: steps.changed-files.outputs.ci_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['ci']
            })

      - name: Add JavaScript label
        if: steps.changed-files.outputs.javascript_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['javascript']
            })

      - name: Add JSON label
        if: steps.changed-files.outputs.json_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['json']
            })

      - name: Add Styles label
        if: steps.changed-files.outputs.styles_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['css', 'styles']
            })

      - name: Add Assets label
        if: steps.changed-files.outputs.assets_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['assets']
            })

      - name: Add Documentation label
        if: steps.changed-files.outputs.documentation_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['doc']
            })

      - name: Add Test label
        if: steps.changed-files.outputs.test_any_changed == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['test']
            })
